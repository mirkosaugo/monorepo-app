"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[385],{4056(e,n,i){i.d(n,{R:()=>c,x:()=>o});var s=i(2155);const r={},l=s.createContext(r);function c(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(l.Provider,{value:n},e.children)}},9517(e,n,i){i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"guides/how-turborepo-works","title":"How Turborepo Works","description":"This guide explains the core concepts of Turborepo and how it optimizes the monorepo workflow.","source":"@site/docs/guides/how-turborepo-works.md","sourceDirName":"guides","slug":"/guides/how-turborepo-works","permalink":"/guides/how-turborepo-works","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Adding New Packages","permalink":"/packages/adding-packages"},"next":{"title":"Development Workflow","permalink":"/guides/development-workflow"}}');var r=i(5723),l=i(4056);const c={sidebar_position:1},o="How Turborepo Works",d={},a=[{value:"What is Turborepo?",id:"what-is-turborepo",level:2},{value:"Core Concepts",id:"core-concepts",level:2},{value:"Tasks",id:"tasks",level:3},{value:"Pipelines",id:"pipelines",level:3},{value:"The <code>^</code> Operator",id:"the--operator",level:3},{value:"Outputs",id:"outputs",level:3},{value:"Execution Flow",id:"execution-flow",level:2},{value:"Caching",id:"caching",level:2},{value:"How Caching Works",id:"how-caching-works",level:3},{value:"Cache Hit Example",id:"cache-hit-example",level:3},{value:"Cache Miss",id:"cache-miss",level:3},{value:"Local Cache",id:"local-cache",level:3},{value:"Clearing Cache",id:"clearing-cache",level:3},{value:"Dependency Graph",id:"dependency-graph",level:2},{value:"Visualizing the Graph",id:"visualizing-the-graph",level:3},{value:"Filtering",id:"filtering",level:2},{value:"Environment Variables",id:"environment-variables",level:2},{value:"Persistent Tasks",id:"persistent-tasks",level:2},{value:"Our Configuration Explained",id:"our-configuration-explained",level:2},{value:"Build Task",id:"build-task",level:3},{value:"Dev Task",id:"dev-task",level:3},{value:"Lint Task",id:"lint-task",level:3},{value:"Performance Tips",id:"performance-tips",level:2},{value:"1. Use Filtering in Development",id:"1-use-filtering-in-development",level:3},{value:"2. Leverage Caching",id:"2-leverage-caching",level:3},{value:"3. Define Outputs Correctly",id:"3-define-outputs-correctly",level:3},{value:"4. Use Remote Caching (Optional)",id:"4-use-remote-caching-optional",level:3},{value:"Common Issues",id:"common-issues",level:2},{value:"Cache Not Working",id:"cache-not-working",level:3},{value:"Wrong Build Order",id:"wrong-build-order",level:3},{value:"Circular Dependencies",id:"circular-dependencies",level:3},{value:"Further Reading",id:"further-reading",level:2}];function t(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"how-turborepo-works",children:"How Turborepo Works"})}),"\n",(0,r.jsx)(n.p,{children:"This guide explains the core concepts of Turborepo and how it optimizes the monorepo workflow."}),"\n",(0,r.jsx)(n.h2,{id:"what-is-turborepo",children:"What is Turborepo?"}),"\n",(0,r.jsx)(n.p,{children:"Turborepo is a high-performance build system for JavaScript/TypeScript monorepos. It provides:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Caching"}),": Skip work that's already been done"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Parallelization"}),": Run tasks concurrently"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Task Pipelines"}),": Define task dependencies"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"core-concepts",children:"Core Concepts"}),"\n",(0,r.jsx)(n.h3,{id:"tasks",children:"Tasks"}),"\n",(0,r.jsxs)(n.p,{children:["Tasks are the operations you run on your packages (build, test, lint, etc.). Defined in ",(0,r.jsx)(n.code,{children:"turbo.json"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "tasks": {\n    "build": {},\n    "test": {},\n    "lint": {}\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"pipelines",children:"Pipelines"}),"\n",(0,r.jsx)(n.p,{children:"Pipelines define how tasks relate to each other:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "tasks": {\n    "build": {\n      "dependsOn": ["^build"],\n      "outputs": ["dist/**", ".next/**"]\n    },\n    "test": {\n      "dependsOn": ["build"]\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.h3,{id:"the--operator",children:["The ",(0,r.jsx)(n.code,{children:"^"})," Operator"]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"^"}),' prefix means "run this task on dependencies first":']}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "build": {\n    "dependsOn": ["^build"]\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["This ensures ",(0,r.jsx)(n.code,{children:"@monorepo-app/ui"})," is built before ",(0,r.jsx)(n.code,{children:"apps/web"})," (which depends on it)."]}),"\n",(0,r.jsx)(n.h3,{id:"outputs",children:"Outputs"}),"\n",(0,r.jsx)(n.p,{children:"Outputs tell Turborepo what to cache:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "build": {\n    "outputs": [".next/**", "dist/**"]\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["When you run ",(0,r.jsx)(n.code,{children:"turbo build"})," again with no changes, Turborepo restores cached outputs instantly."]}),"\n",(0,r.jsx)(n.h2,{id:"execution-flow",children:"Execution Flow"}),"\n",(0,r.jsxs)(n.p,{children:["When you run ",(0,r.jsx)(n.code,{children:"pnpm dev"})," (which calls ",(0,r.jsx)(n.code,{children:"turbo dev"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"1. Turborepo reads turbo.json\n2. Analyzes package.json files to find workspaces\n3. Builds dependency graph\n4. Determines task execution order\n5. Runs tasks in parallel where possible\n6. Caches outputs for future runs\n"})}),"\n",(0,r.jsx)(n.h2,{id:"caching",children:"Caching"}),"\n",(0,r.jsx)(n.h3,{id:"how-caching-works",children:"How Caching Works"}),"\n",(0,r.jsx)(n.p,{children:"Turborepo creates a hash based on:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Source files"}),"\n",(0,r.jsx)(n.li,{children:"Environment variables"}),"\n",(0,r.jsx)(n.li,{children:"Dependencies"}),"\n",(0,r.jsx)(n.li,{children:"Task configuration"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"If the hash matches a previous run, cached outputs are restored."}),"\n",(0,r.jsx)(n.h3,{id:"cache-hit-example",children:"Cache Hit Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ pnpm build\n\n@monorepo-app/ui:build: cache hit, replaying logs\n@monorepo-app/ui:build:\n@monorepo-app/ui:build: > @monorepo-app/ui@0.0.1 build\n@monorepo-app/ui:build: > tsc\n@monorepo-app/ui:build:\n\nweb:build: cache hit, replaying logs\n...\n"})}),"\n",(0,r.jsx)(n.h3,{id:"cache-miss",children:"Cache Miss"}),"\n",(0,r.jsx)(n.p,{children:"When files change, Turborepo detects this and rebuilds:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ pnpm build\n\n@monorepo-app/ui:build: cache miss, executing\n...\n"})}),"\n",(0,r.jsx)(n.h3,{id:"local-cache",children:"Local Cache"}),"\n",(0,r.jsxs)(n.p,{children:["By default, cache is stored in ",(0,r.jsx)(n.code,{children:".turbo/"})," directory:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:".turbo/\n\u2514\u2500\u2500 cache/\n    \u251c\u2500\u2500 abc123...   # Cached build output\n    \u2514\u2500\u2500 def456...   # Another cached output\n"})}),"\n",(0,r.jsx)(n.h3,{id:"clearing-cache",children:"Clearing Cache"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Clear turbo cache\nrm -rf .turbo\n\n# Or force a fresh build\npnpm turbo build --force\n"})}),"\n",(0,r.jsx)(n.h2,{id:"dependency-graph",children:"Dependency Graph"}),"\n",(0,r.jsx)(n.p,{children:"Turborepo automatically builds a dependency graph:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502  @monorepo-app/ui   \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                           \u2502\n           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n           \u2502               \u2502               \u2502\n           \u25bc               \u25bc               \u25bc\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502    web      \u2502 \u2502  storybook  \u2502 \u2502    docs     \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsx)(n.h3,{id:"visualizing-the-graph",children:"Visualizing the Graph"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pnpm turbo build --graph\n"})}),"\n",(0,r.jsx)(n.p,{children:"This generates a visual representation of your dependency graph."}),"\n",(0,r.jsx)(n.h2,{id:"filtering",children:"Filtering"}),"\n",(0,r.jsx)(n.p,{children:"Run tasks on specific packages:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Single package\npnpm turbo build --filter=web\n\n# Multiple packages\npnpm turbo build --filter=web --filter=storybook\n\n# Package and its dependencies\npnpm turbo build --filter=web...\n\n# All packages that depend on @monorepo-app/ui\npnpm turbo build --filter=...@monorepo-app/ui\n"})}),"\n",(0,r.jsx)(n.h2,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,r.jsx)(n.p,{children:"Include environment variables in the cache key:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "tasks": {\n    "build": {\n      "env": ["NODE_ENV", "API_URL"]\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"Changes to these variables will invalidate the cache."}),"\n",(0,r.jsx)(n.h2,{id:"persistent-tasks",children:"Persistent Tasks"}),"\n",(0,r.jsx)(n.p,{children:"For development servers that don't exit:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "tasks": {\n    "dev": {\n      "cache": false,\n      "persistent": true\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cache: false"})," - Don't cache dev server output"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"persistent: true"}),' - Keep running (don\'t consider task "done")']}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"our-configuration-explained",children:"Our Configuration Explained"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "$schema": "https://turbo.build/schema.json",\n  "tasks": {\n    "build": {\n      "dependsOn": ["^build"],\n      "outputs": [\n        ".next/**",\n        "!.next/cache/**",\n        "dist/**",\n        "storybook-static/**"\n      ]\n    },\n    "dev": {\n      "cache": false,\n      "persistent": true\n    },\n    "lint": {\n      "dependsOn": ["^build"]\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"build-task",children:"Build Task"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'dependsOn: ["^build"]'})," - Build dependencies first"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"outputs"})," - Cache Next.js, dist, and Storybook outputs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"!.next/cache/**"})," - Don't cache Next.js's own cache"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"dev-task",children:"Dev Task"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cache: false"})," - Never cache (always fresh)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"persistent: true"})," - Runs continuously"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"lint-task",children:"Lint Task"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'dependsOn: ["^build"]'})," - Ensure code is built before linting"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"performance-tips",children:"Performance Tips"}),"\n",(0,r.jsx)(n.h3,{id:"1-use-filtering-in-development",children:"1. Use Filtering in Development"}),"\n",(0,r.jsx)(n.p,{children:"Instead of running everything:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pnpm dev\n"})}),"\n",(0,r.jsx)(n.p,{children:"Run only what you need:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pnpm turbo dev --filter=web\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-leverage-caching",children:"2. Leverage Caching"}),"\n",(0,r.jsx)(n.p,{children:"Don't clear cache unnecessarily. Let Turborepo determine what needs rebuilding."}),"\n",(0,r.jsx)(n.h3,{id:"3-define-outputs-correctly",children:"3. Define Outputs Correctly"}),"\n",(0,r.jsx)(n.p,{children:"Missing outputs = broken cache:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "build": {\n    "outputs": ["dist/**"]  // Make sure ALL outputs are listed\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"4-use-remote-caching-optional",children:"4. Use Remote Caching (Optional)"}),"\n",(0,r.jsx)(n.p,{children:"Share cache across team members:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npx turbo login\nnpx turbo link\n"})}),"\n",(0,r.jsx)(n.h2,{id:"common-issues",children:"Common Issues"}),"\n",(0,r.jsx)(n.h3,{id:"cache-not-working",children:"Cache Not Working"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Check outputs are defined correctly"}),"\n",(0,r.jsx)(n.li,{children:"Verify files haven't changed"}),"\n",(0,r.jsxs)(n.li,{children:["Run with ",(0,r.jsx)(n.code,{children:"--verbosity=2"})," for details"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"wrong-build-order",children:"Wrong Build Order"}),"\n",(0,r.jsxs)(n.p,{children:["Ensure dependencies are declared in ",(0,r.jsx)(n.code,{children:"package.json"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "dependencies": {\n    "@monorepo-app/ui": "workspace:*"\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"circular-dependencies",children:"Circular Dependencies"}),"\n",(0,r.jsx)(n.p,{children:"Turborepo will error on circular dependencies. Fix by restructuring packages."}),"\n",(0,r.jsx)(n.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://turbo.build/repo/docs",children:"Turborepo Documentation"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://turbo.build/repo/docs/reference/configuration",children:"Task Configuration"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://turbo.build/repo/docs/core-concepts/caching",children:"Caching"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(t,{...e})}):t(e)}}}]);